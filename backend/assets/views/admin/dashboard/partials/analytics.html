<!-- Generation Analytics Panel -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Generation Stats -->
    <div class="bg-card text-card-foreground rounded-xl border shadow-sm">
        <div class="px-6 py-4 border-b">
            <h2 class="text-lg font-semibold">Generation Statistics</h2>
        </div>
        <div class="p-6">
            <!-- Summary Stats -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="p-4 bg-muted/30 rounded-lg">
                    <p class="text-3xl font-bold">{{ analytics.generation_stats.total_requests }}</p>
                    <p class="text-sm text-muted-foreground">Total Requests</p>
                </div>
                <div class="p-4 bg-muted/30 rounded-lg">
                    <p class="text-3xl font-bold text-green-600">{{ analytics.generation_stats.success_rate | round }}%</p>
                    <p class="text-sm text-muted-foreground">Success Rate</p>
                </div>
            </div>

            <!-- Time Period Stats -->
            <div class="space-y-3">
                <div class="flex items-center justify-between py-2 border-b">
                    <span class="text-sm">Last 24 hours</span>
                    <span class="font-medium">{{ analytics.generation_stats.requests_last_24h }} requests</span>
                </div>
                <div class="flex items-center justify-between py-2 border-b">
                    <span class="text-sm">Last 7 days</span>
                    <span class="font-medium">{{ analytics.generation_stats.requests_last_7d }} requests</span>
                </div>
                <div class="flex items-center justify-between py-2 border-b">
                    <span class="text-sm">Last 30 days</span>
                    <span class="font-medium">{{ analytics.generation_stats.requests_last_30d }} requests</span>
                </div>
                <div class="flex items-center justify-between py-2">
                    <span class="text-sm">Avg. Generation Time</span>
                    <span class="font-medium">{{ analytics.generation_stats.avg_generation_time_ms | round }}ms</span>
                </div>
            </div>

            <!-- Success/Failure Breakdown -->
            <div class="mt-6 pt-4 border-t">
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <span class="h-3 w-3 rounded-full bg-green-500"></span>
                        <span class="text-sm">Success: {{ analytics.generation_stats.success_count }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="h-3 w-3 rounded-full bg-red-500"></span>
                        <span class="text-sm">Failed: {{ analytics.generation_stats.failure_count }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Request Categories -->
    <div class="bg-card text-card-foreground rounded-xl border shadow-sm">
        <div class="px-6 py-4 border-b">
            <h2 class="text-lg font-semibold">Request Categories</h2>
        </div>
        <div class="p-6 space-y-6">
            <!-- By Product -->
            <div>
                <h3 class="text-sm font-medium mb-3">By Product</h3>
                {% if analytics.by_product | length > 0 %}
                <div class="space-y-2">
                    {% for item in analytics.by_product %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2 flex-1 min-w-0">
                            <span class="text-sm truncate">{{ item.category }}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-24 h-2 bg-muted rounded-full overflow-hidden">
                                <div class="h-full bg-primary" style="width: {{ item.percentage | round }}%"></div>
                            </div>
                            <span class="text-xs text-muted-foreground w-12 text-right">{{ item.count }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-sm text-muted-foreground">No data available</p>
                {% endif %}
            </div>

            <!-- By Input Type -->
            <div>
                <h3 class="text-sm font-medium mb-3">By Input Type</h3>
                {% if analytics.by_input_type | length > 0 %}
                <div class="space-y-2">
                    {% for item in analytics.by_input_type %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2 flex-1 min-w-0">
                            <span class="text-sm truncate">
                                {% if item.category == "db-schema" %}DB Schema
                                {% elif item.category == "query-sample" %}Query Sample
                                {% elif item.category == "natural-language" %}Natural Language
                                {% else %}{{ item.category }}{% endif %}
                            </span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-24 h-2 bg-muted rounded-full overflow-hidden">
                                <div class="h-full bg-blue-500" style="width: {{ item.percentage | round }}%"></div>
                            </div>
                            <span class="text-xs text-muted-foreground w-12 text-right">{{ item.count }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-sm text-muted-foreground">No data available</p>
                {% endif %}
            </div>

            <!-- By Status -->
            <div>
                <h3 class="text-sm font-medium mb-3">By Status</h3>
                {% if analytics.by_status | length > 0 %}
                <div class="space-y-2">
                    {% for item in analytics.by_status %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2 flex-1 min-w-0">
                            <span class="h-2 w-2 rounded-full {% if item.category == 'success' %}bg-green-500{% else %}bg-red-500{% endif %}"></span>
                            <span class="text-sm truncate capitalize">{{ item.category }}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-24 h-2 bg-muted rounded-full overflow-hidden">
                                <div class="h-full {% if item.category == 'success' %}bg-green-500{% else %}bg-red-500{% endif %}"
                                     style="width: {{ item.percentage | round }}%"></div>
                            </div>
                            <span class="text-xs text-muted-foreground w-12 text-right">{{ item.count }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-sm text-muted-foreground">No data available</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Requests Over Time (Simple Bar Chart) -->
<div class="mt-6 bg-card text-card-foreground rounded-xl border shadow-sm">
    <div class="px-6 py-4 border-b flex items-center justify-between">
        <h2 class="text-lg font-semibold">Requests Over Time (Last 7 Days)</h2>
        <span class="text-xs text-muted-foreground">Auto-refresh: 30s</span>
    </div>
    <div class="p-6">
        {% if analytics.requests_by_day %}
        <div class="flex items-end justify-between gap-2 h-32">
            {% for point in analytics.requests_by_day %}
            <div class="flex-1 flex flex-col items-center gap-1">
                <div class="w-full bg-primary rounded-t transition-all duration-500"
                     style="height: {% if point.value > 0 %}{{ point.value * 5 }}px{% else %}2px{% endif %}; min-height: 2px; max-height: 100px;"></div>
                <span class="text-xs text-muted-foreground">{{ point.label }}</span>
                <span class="text-xs font-medium">{{ point.value }}</span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="h-32 flex items-center justify-center">
            <p class="text-muted-foreground">No generation data available yet</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Recent Activity -->
<div class="mt-6 bg-card text-card-foreground rounded-xl border shadow-sm">
    <div class="px-6 py-4 border-b">
        <h2 class="text-lg font-semibold">Recent Activity</h2>
    </div>
    <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="p-4 bg-muted/30 rounded-lg">
                <p class="text-sm text-muted-foreground">Last Generation</p>
                <p class="text-lg font-medium">
                    {% if analytics.recent_activity.last_generation_at %}
                    {{ analytics.recent_activity.last_generation_at | date(format="%Y-%m-%d %H:%M") }}
                    {% else %}
                    No generations yet
                    {% endif %}
                </p>
            </div>
            <div class="p-4 bg-muted/30 rounded-lg">
                <p class="text-sm text-muted-foreground">Active Users (24h)</p>
                <p class="text-lg font-medium">{{ analytics.recent_activity.active_users_24h }}</p>
            </div>
        </div>
    </div>
</div>
