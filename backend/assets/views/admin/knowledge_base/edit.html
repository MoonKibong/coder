<!-- Edit Knowledge Base Entry Modal -->
<div class="fixed inset-0 z-50 bg-black/50" onclick="if(event.target === this) this.remove()">
    <div class="fixed inset-y-0 right-0 w-full max-w-3xl bg-background shadow-xl overflow-hidden flex flex-col"
         onclick="event.stopPropagation()">
        <!-- Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b">
            <h2 class="text-lg font-semibold">Edit Knowledge Base Entry</h2>
            <button onclick="this.closest('.fixed').remove()"
                class="inline-flex items-center justify-center rounded-md h-8 w-8 hover:bg-accent">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Form -->
        <form hx-patch="/admin/knowledge-bases/{{ item.id }}" hx-ext="json-enc" hx-target="#search-result" hx-swap="outerHTML"
              hx-on::after-request="if(event.detail.successful) this.closest('.fixed').remove()"
              class="flex-1 overflow-y-auto p-6">
            <div class="space-y-6">
                <!-- Name -->
                <div class="space-y-2">
                    <label for="name" class="text-sm font-medium">Name <span class="text-destructive">*</span></label>
                    <input type="text" id="name" name="name" value="{{ item.name }}" required
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm
                               placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"
                        placeholder="e.g., dataset_basic_syntax" />
                    <p class="text-xs text-muted-foreground">Unique identifier (use snake_case)</p>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <!-- Category -->
                    <div class="space-y-2">
                        <label for="category" class="text-sm font-medium">Category <span class="text-destructive">*</span></label>
                        <select id="category" name="category" required
                            class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm
                                   focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
                            <option value="">Select category...</option>
                            <option value="architecture" {% if item.category == "architecture" %}selected{% endif %}>Architecture</option>
                            <option value="component" {% if item.category == "component" %}selected{% endif %}>Component</option>
                            <option value="pattern" {% if item.category == "pattern" %}selected{% endif %}>Pattern</option>
                            <option value="example" {% if item.category == "example" %}selected{% endif %}>Example</option>
                            <option value="standard" {% if item.category == "standard" %}selected{% endif %}>Standard</option>
                        </select>
                    </div>

                    <!-- Component -->
                    <div class="space-y-2">
                        <label for="component" class="text-sm font-medium">Component</label>
                        <input type="text" id="component" name="component" value="{{ item.component or '' }}"
                            class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm
                                   placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"
                            placeholder="e.g., dataset, grid, button" />
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <!-- Section -->
                    <div class="space-y-2">
                        <label for="section" class="text-sm font-medium">Section</label>
                        <input type="text" id="section" name="section" value="{{ item.section or '' }}"
                            class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm
                                   placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"
                            placeholder="e.g., basic_syntax, events" />
                    </div>

                    <!-- Priority -->
                    <div class="space-y-2">
                        <label for="priority" class="text-sm font-medium">Priority</label>
                        <select id="priority" name="priority"
                            class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm
                                   focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
                            <option value="">Not set</option>
                            <option value="high" {% if item.priority == "high" %}selected{% endif %}>High</option>
                            <option value="medium" {% if item.priority == "medium" %}selected{% endif %}>Medium</option>
                            <option value="low" {% if item.priority == "low" %}selected{% endif %}>Low</option>
                        </select>
                    </div>
                </div>

                <!-- Relevance Tags -->
                <div class="space-y-2">
                    <label for="relevance_tags" class="text-sm font-medium">Relevance Tags</label>
                    <input type="text" id="relevance_tags" name="relevance_tags"
                           value="{% if item.relevance_tags %}{{ item.relevance_tags | join(sep=", ") }}{% endif %}"
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm
                               placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"
                        placeholder="list_screen, detail_screen, master_detail" />
                    <p class="text-xs text-muted-foreground">Comma-separated tags (when to include this knowledge)</p>
                </div>

                <!-- Content -->
                <div class="space-y-2">
                    <label for="content" class="text-sm font-medium">Content <span class="text-destructive">*</span></label>
                    <textarea id="content" name="content" rows="12" required
                        class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm
                               placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring
                               font-mono resize-y"
                        placeholder="Markdown content with code examples...">{{ item.content }}</textarea>
                    <p class="text-xs text-muted-foreground">
                        Use Markdown formatting. Include code examples in triple backticks.
                    </p>
                </div>

                <!-- Token Estimate -->
                <div class="space-y-2">
                    <label for="token_estimate" class="text-sm font-medium">Token Estimate</label>
                    <input type="number" id="token_estimate" name="token_estimate" value="{{ item.token_estimate or '' }}" min="0"
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm
                               placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"
                        placeholder="Approximate token count" />
                    <p class="text-xs text-muted-foreground">Rough estimate: ~4 characters = 1 token</p>
                </div>

                <!-- Is Active -->
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="is_active" name="is_active" value="true"
                        {% if item.is_active %}checked{% endif %}
                        class="h-4 w-4 rounded border-input" />
                    <label for="is_active" class="text-sm font-medium">Active</label>
                </div>
            </div>
        </form>

        <!-- Footer -->
        <div class="flex items-center justify-end gap-2 px-6 py-4 border-t bg-muted/30">
            <button onclick="this.closest('.fixed').remove()"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-4 py-2
                       border bg-background shadow-sm hover:bg-accent hover:text-accent-foreground">
                Cancel
            </button>
            <button type="submit"
                onclick="this.closest('.fixed').querySelector('form').requestSubmit()"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-4 py-2
                       bg-primary text-primary-foreground shadow-sm hover:bg-primary/90">
                Save Changes
            </button>
        </div>
    </div>
</div>
